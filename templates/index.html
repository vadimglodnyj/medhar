<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–¥–∏—á–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
      }
      label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
      }
      input[type="text"],
      select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        box-sizing: border-box;
      }
      .checkbox-container {
        margin-top: 20px;
        display: flex;
        align-items: center;
      }
      .checkbox-container input {
        width: auto;
        margin-right: 10px;
      }
      input[type="submit"] {
        margin-top: 25px;
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
      }
      input[type="submit"]:disabled {
        background-color: #5a9cec;
        cursor: not-allowed;
      }
      .loader-overlay {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.7);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
      }
      .loader-text {
        margin-top: 20px;
        color: #333;
        font-size: 18px;
        font-weight: bold;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–ø–ª—ñ—Ç—É */
      .autocomplete-container {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .autocomplete-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ccc;
        border-top: none;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }

      .autocomplete-suggestion {
        padding: 8px 12px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
      }

      .autocomplete-suggestion:hover,
      .autocomplete-suggestion.selected {
        background-color: #f0f0f0;
      }

      .autocomplete-suggestion:last-child {
        border-bottom: none;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å */
      .alert {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }

      .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
    </style>
  </head>
  <body>
    <div id="loader" class="loader-overlay" style="display: none">
      <div class="spinner"></div>
      <div class="loader-text">
        –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—É... –ó–∞—á–µ–∫–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞.
      </div>
    </div>
    python test_name_formatting.py    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ñ–π—Å—å–∫–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h1>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö -->
    <div
      id="db-stats"
      style="
        background-color: #e8f4f8;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-size: 14px;
      "
    >
      <strong>–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:</strong> <span id="stats-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
    </div>

    <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div
      class="alert alert-{{ 'error' if category == 'error' else 'success' }}"
    >
      {{ message }}
    </div>
    {% endfor %} {% endif %} {% endwith %}

    <div style="text-align: center; margin: 30px 0">
      <h2>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó:</h2>
      <div
        style="
          display: flex;
          gap: 20px;
          justify-content: center;
          flex-wrap: wrap;
        "
      >
        <a
          href="/medical-characteristic"
          style="
            display: inline-block;
            padding: 20px 30px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
          "
          onmouseover="this.style.backgroundColor='#0056b3'"
          onmouseout="this.style.backgroundColor='#007bff'"
        >
          üè• –ú–µ–¥–∏—á–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞
        </a>
        <a
          href="/service-characteristic"
          style="
            display: inline-block;
            padding: 20px 30px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
          "
          onmouseover="this.style.backgroundColor='#1e7e34'"
          onmouseout="this.style.backgroundColor='#28a745'"
        >
          üìã –°–ª—É–∂–±–æ–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞
        </a>
        <a
          href="/vlk-report"
          style="
            display: inline-block;
            padding: 20px 30px;
            background-color: #dc3545;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
          "
          onmouseover="this.style.backgroundColor='#c82333'"
          onmouseout="this.style.backgroundColor='#dc3545'"
        >
          ü©∫ –†–∞–ø–æ—Ä—Ç –í–õ–ö
        </a>
      </div>
    </div>

    <form id="generation-form" method="POST" style="display: none">
      <label for="pib_nazivnyi">–ü–Ü–ë (–≤ –Ω–∞–∑–∏–≤–Ω–æ–º—É –≤—ñ–¥–º—ñ–Ω–∫—É):</label>
      <div class="autocomplete-container">
        <input
          type="text"
          id="pib_nazivnyi"
          name="pib_nazivnyi"
          placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –ü–Ü–ë –¥–ª—è –ø–æ—à—É–∫—É..."
          required
        />
        <div id="pib-suggestions" class="autocomplete-suggestions"></div>
      </div>
      <label for="pib_rodovyi">–ü–Ü–ë (–≤ —Ä–æ–¥–æ–≤–æ–º—É –≤—ñ–¥–º—ñ–Ω–∫—É):</label>
      <div style="display: flex; gap: 5px; align-items: center">
        <input
          type="text"
          id="pib_rodovyi"
          name="pib_rodovyi"
          placeholder="–ü—Ä—ñ–∑–≤–∏—â–∞ –Ü–º–µ–Ω—ñ –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ"
          required
          style="flex: 1"
        />
        <button
          type="button"
          id="regenerate-rodovyi"
          style="
            padding: 8px 12px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
          "
          title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ä–æ–¥–æ–≤—ñ–π –≤—ñ–¥–º—ñ–Ω–æ–∫"
        >
          üîÑ
        </button>
        <span
          id="rodovyi-status"
          style="font-size: 12px; color: #6c757d; font-style: italic"
        ></span>
      </div>
      <div
        style="
          font-size: 12px;
          color: #dc3545;
          margin-top: 5px;
          font-weight: bold;
        "
      >
        ‚ö†Ô∏è –£–í–ê–ì–ê: –í–≤–µ–¥—ñ—Ç—å –ü–Ü–ë –≤ —Ä–æ–¥–æ–≤–æ–º—É –≤—ñ–¥–º—ñ–Ω–∫—É –≤—Ä—É—á–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –Ü–≤–∞–Ω–æ–≤–∞
        –Ü–≤–∞–Ω–∞ –Ü–≤–∞–Ω–æ–≤–∏—á–∞)
      </div>
      <label for="enlistment_date">–î–∞—Ç–∞ –∑–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≤ —Å–ø–∏—Å–∫–∏ —á–∞—Å—Ç–∏–Ω–∏:</label>
      <select
        id="enlistment_date"
        name="enlistment_date"
        required
        onchange="toggleCustomDate()"
      >
        <option value="">–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç</option>
        <option value="–∑ –º–æ–º–µ–Ω—Ç—É –ø—Ä–∏–∑–æ–≤—É">–ó –º–æ–º–µ–Ω—Ç—É –ø—Ä–∏–∑–æ–≤—É</option>
        <option value="custom">–í–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É</option>
      </select>
      <input
        type="text"
        id="enlistment_date_custom"
        name="enlistment_date_custom"
        placeholder="–¥–¥.–º–º.—Ä—Ä—Ä—Ä"
        pattern="\d{2}\.\d{2}\.\d{4}"
        title="–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä—Ä—Ä"
        style="display: none; margin-top: 10px"
      />
      <hr style="margin-top: 20px" />
      <p
        style="
          text-align: center;
          font-weight: bold;
          background-color: #f0f0f0;
          padding: 10px;
          border-radius: 5px;
        "
      >
        –ó–∞–ø–æ–≤–Ω—é–π—Ç–µ, —è–∫—â–æ –≤—ñ–π—Å—å–∫–æ–≤–æ–≥–æ –Ω–µ–º–∞—î –≤ —Ç–∞–±–ª–∏—Ü—ñ
      </p>
      <label for="zvanie">–í—ñ–π—Å—å–∫–æ–≤–µ –∑–≤–∞–Ω–Ω—è:</label>
      <select id="zvanie" name="zvanie">
        <option value="">–û–±–µ—Ä—ñ—Ç—å –∑–≤–∞–Ω–Ω—è</option>
        <option value="—Å–æ–ª–¥–∞—Ç">—Å–æ–ª–¥–∞—Ç</option>
        <option value="—Å—Ç–∞—Ä—à–∏–π —Å–æ–ª–¥–∞—Ç">—Å—Ç–∞—Ä—à–∏–π —Å–æ–ª–¥–∞—Ç</option>
        <option value="–º–æ–ª–æ–¥—à–∏–π —Å–µ—Ä–∂–∞–Ω—Ç">–º–æ–ª–æ–¥—à–∏–π —Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="—Å–µ—Ä–∂–∞–Ω—Ç">—Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="—Å—Ç–∞—Ä—à–∏–π —Å–µ—Ä–∂–∞–Ω—Ç">—Å—Ç–∞—Ä—à–∏–π —Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="–≥–æ–ª–æ–≤–Ω–∏–π —Å–µ—Ä–∂–∞–Ω—Ç">–≥–æ–ª–æ–≤–Ω–∏–π —Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="—à—Ç–∞–±-—Å–µ—Ä–∂–∞–Ω—Ç">—à—Ç–∞–±-—Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="–º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç">–º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="—Å—Ç–∞—Ä—à–∏–π –º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç">—Å—Ç–∞—Ä—à–∏–π –º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç</option>
        <option value="–≥–æ–ª–æ–≤–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç">
          –≥–æ–ª–æ–≤–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä-—Å–µ—Ä–∂–∞–Ω—Ç
        </option>
        <option value="–º–æ–ª–æ–¥—à–∏–π –ª–µ–π—Ç–µ–Ω–∞–Ω—Ç">–º–æ–ª–æ–¥—à–∏–π –ª–µ–π—Ç–µ–Ω–∞–Ω—Ç</option>
        <option value="–ª–µ–π—Ç–µ–Ω–∞–Ω—Ç">–ª–µ–π—Ç–µ–Ω–∞–Ω—Ç</option>
        <option value="—Å—Ç–∞—Ä—à–∏–π –ª–µ–π—Ç–µ–Ω–∞–Ω—Ç">—Å—Ç–∞—Ä—à–∏–π –ª–µ–π—Ç–µ–Ω–∞–Ω—Ç</option>
        <option value="–∫–∞–ø—ñ—Ç–∞–Ω">–∫–∞–ø—ñ—Ç–∞–Ω</option>
        <option value="–º–∞–π–æ—Ä">–º–∞–π–æ—Ä</option>
        <option value="–ø—ñ–¥–ø–æ–ª–∫–æ–≤–Ω–∏–∫">–ø—ñ–¥–ø–æ–ª–∫–æ–≤–Ω–∏–∫</option>
        <option value="–ø–æ–ª–∫–æ–≤–Ω–∏–∫">–ø–æ–ª–∫–æ–≤–Ω–∏–∫</option>
      </select>
      <label for="sluzhba_type">–í–∏–¥ —Å–ª—É–∂–±–∏:</label>
      <select id="sluzhba_type" name="sluzhba_type">
        <option value="–ø—ñ–¥ —á–∞—Å –º–æ–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó">–ø—ñ–¥ —á–∞—Å –º–æ–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó</option>
        <option value="–∑–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º">–∑–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º</option>
      </select>
      <label for="birth_date">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (–¥–¥.–º–º.—Ä—Ä—Ä):</label>
      <input
        type="text"
        id="birth_date"
        name="birth_date"
        placeholder="–¥–¥.–º–º.—Ä—Ä—Ä—Ä"
        pattern="\d{2}\.\d{2}\.\d{4}"
        title="–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä—Ä—Ä"
      />
      <div class="checkbox-container">
        <input
          type="checkbox"
          id="no_diagnosis"
          name="no_diagnosis"
          value="yes"
        />
        <label for="no_diagnosis"
          >–î–ª—è —Å–ª—É–∂–±–æ–≤–æ–≥–æ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è (–±–µ–∑ –¥—ñ–∞–≥–Ω–æ–∑—ñ–≤)</label
        >
      </div>

      <input id="submit-button" type="submit" value="–°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç" />
    </form>

    <script>
      const form = document.getElementById("generation-form");
      const submitButton = document.getElementById("submit-button");
      const loader = document.getElementById("loader");
      const pibNazivnyi = document.getElementById("pib_nazivnyi");
      const pibRodovyi = document.getElementById("pib_rodovyi");
      const pibSuggestions = document.getElementById("pib-suggestions");

      let currentSuggestions = [];
      let selectedIndex = -1;

      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
      async function loadDatabaseStats() {
        try {
          const response = await fetch("/api/stats");

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const stats = await response.json();

          if (stats.error) {
            document.getElementById("stats-text").textContent =
              "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è";
            return;
          }

          const statsText = `${stats.total_records} –∑–∞–ø–∏—Å—ñ–≤, ${stats.unique_patients} —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤`;
          document.getElementById("stats-text").textContent = statsText;
        } catch (error) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
          document.getElementById("stats-text").textContent =
            "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è";
        }
      }

      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      document.addEventListener("DOMContentLoaded", loadDatabaseStats);

      function getCookie(name) {
        let a = `; ${document.cookie}`.match(`;\\s*${name}=([^;]+)`);
        return a ? a[1] : "";
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ—à—É–∫—É –ü–Ü–ë
      async function searchPIB(query) {
        if (query.length < 2) {
          hideSuggestions();
          return;
        }

        try {
          const response = await fetch(
            `/api/search_pib?q=${encodeURIComponent(query)}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.results && data.results.length > 0) {
            showSuggestions(data.results);
          } else {
            hideSuggestions();
          }
        } catch (error) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–æ—à—É–∫—É –ü–Ü–ë:", error);
          hideSuggestions();
          // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
          if (error.message.includes("JSON")) {
            console.error(
              "–°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π JSON. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞—Ü—é—î —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ."
            );
            console.error("–ú–æ–∂–ª–∏–≤–æ, —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π –∞–±–æ —î –ø–æ–º–∏–ª–∫–∞ –≤ –∫–æ–¥—ñ.");
          }

          // –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –¥–µ–±–∞–≥—É
          console.error(
            "URL –∑–∞–ø–∏—Ç—É:",
            `/api/search_pib?q=${encodeURIComponent(query)}`
          );
          console.error("–ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏:", error);
        }
      }

      // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
      function showSuggestions(suggestions) {
        currentSuggestions = suggestions;
        selectedIndex = -1;

        pibSuggestions.innerHTML = "";

        suggestions.forEach((suggestion, index) => {
          const div = document.createElement("div");
          div.className = "autocomplete-suggestion";
          div.textContent = suggestion.label;
          div.dataset.value = suggestion.value;
          div.dataset.index = index;

          div.addEventListener("click", function () {
            selectSuggestion(suggestion);
          });

          pibSuggestions.appendChild(div);
        });

        pibSuggestions.style.display = "block";
      }

      // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
      function hideSuggestions() {
        pibSuggestions.style.display = "none";
        currentSuggestions = [];
        selectedIndex = -1;
      }

      // –í–∏–±—Ä–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é
      function selectSuggestion(suggestion) {
        const value =
          typeof suggestion === "string" ? suggestion : suggestion.value;
        const data = typeof suggestion === "object" ? suggestion : null;

        pibNazivnyi.value = value;

        // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ —Ä–æ–¥–æ–≤–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∫—É
        pibRodovyi.value = "";

        // –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–≤–∞–Ω–Ω—è —Ç–∞ –¥–∞—Ç–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —è–∫—â–æ —î –¥–∞–Ω—ñ
        if (data && data.rank) {
          const rankSelect = document.getElementById("zvanie");
          if (rankSelect) {
            // –®—É–∫–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –∑–≤–∞–Ω–Ω—è –≤ —Å–µ–ª–µ–∫—Ç—ñ
            for (let option of rankSelect.options) {
              if (option.value.toLowerCase() === data.rank.toLowerCase()) {
                rankSelect.value = option.value;
                break;
              }
            }
          }
        }

        if (data && data.birth_date) {
          const birthDateInput = document.getElementById("birth_date");
          if (birthDateInput && !birthDateInput.value) {
            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç –¥–¥.–º–º.—Ä—Ä—Ä—Ä
            try {
              const date = new Date(data.birth_date);
              if (!isNaN(date.getTime())) {
                const day = String(date.getDate()).padStart(2, "0");
                const month = String(date.getMonth() + 1).padStart(2, "0");
                const year = date.getFullYear();
                birthDateInput.value = `${day}.${month}.${year}`;
              }
            } catch (e) {
              console.log("–ù–µ –≤–¥–∞–ª–æ—Å—è –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è");
            }
          }
        }

        hideSuggestions();
      }

      // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
      function handleKeyNavigation(e) {
        if (pibSuggestions.style.display === "none") return;

        const suggestions = pibSuggestions.querySelectorAll(
          ".autocomplete-suggestion"
        );

        switch (e.key) {
          case "ArrowDown":
            e.preventDefault();
            selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
            updateSelection(suggestions);
            break;
          case "ArrowUp":
            e.preventDefault();
            selectedIndex = Math.max(selectedIndex - 1, -1);
            updateSelection(suggestions);
            break;
          case "Enter":
            e.preventDefault();
            if (selectedIndex >= 0 && suggestions[selectedIndex]) {
              const suggestionData = currentSuggestions[selectedIndex];
              selectSuggestion(suggestionData);
            }
            break;
          case "Escape":
            hideSuggestions();
            break;
        }
      }

      // –û–Ω–æ–≤–∏—Ç–∏ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è
      function updateSelection(suggestions) {
        suggestions.forEach((suggestion, index) => {
          suggestion.classList.toggle("selected", index === selectedIndex);
        });
      }

      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞—Ç–∏
      function validateDate(dateString) {
        const pattern = /^(\d{2})\.(\d{2})\.(\d{4})$/;
        const match = dateString.match(pattern);
        if (!match) return false;

        const day = parseInt(match[1], 10);
        const month = parseInt(match[2], 10);
        const year = parseInt(match[3], 10);

        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;
        if (year < 1900 || year > new Date().getFullYear()) return false;

        const date = new Date(year, month - 1, day);
        return (
          date.getDate() === day &&
          date.getMonth() === month - 1 &&
          date.getFullYear() === year
        );
      }

      // –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ä–æ–¥–æ–≤–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∫—É —Ç–∞ –ø–æ—à—É–∫ –ü–Ü–ë
      let searchTimeout;
      let rodovyiTimeout;

      pibNazivnyi.addEventListener("input", function () {
        // –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ä–æ–¥–æ–≤–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∫—É –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
        clearTimeout(rodovyiTimeout);
        // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ —Ä–æ–¥–æ–≤–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∫—É –ø—Ä–∏ –∑–º—ñ–Ω—ñ –ü–Ü–ë
        pibRodovyi.value = "";

        // –ü–æ—à—É–∫ –ü–Ü–ë –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchPIB(pibNazivnyi.value);
        }, 300);
      });

      // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
      pibNazivnyi.addEventListener("keydown", handleKeyNavigation);

      // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –ø–æ–ª–µ–º
      document.addEventListener("click", function (e) {
        if (
          !pibNazivnyi.contains(e.target) &&
          !pibSuggestions.contains(e.target)
        ) {
          hideSuggestions();
        }
      });

      // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ä–æ–¥–æ–≤–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∫—É
      document
        .getElementById("regenerate-rodovyi")
        .addEventListener("click", function () {
          // –ö–Ω–æ–ø–∫–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤—ñ–¥–º—ñ–Ω–∫—ñ–≤ –≤–∏–¥–∞–ª–µ–Ω–∞
          alert(
            "–§—É–Ω–∫—Ü—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥–º—ñ–Ω—é–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–∞. –í–≤–µ–¥—ñ—Ç—å –ü–Ü–ë –≤ —Ä–æ–¥–æ–≤–æ–º—É –≤—ñ–¥–º—ñ–Ω–∫—É –≤—Ä—É—á–Ω—É."
          );
        });

      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–ª—è –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É (select)
      document
        .getElementById("enlistment_date")
        .addEventListener("change", function () {
          if (!this.value) {
            this.setCustomValidity("–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É");
          } else if (
            this.value === "–∑ –º–æ–º–µ–Ω—Ç—É –ø—Ä–∏–∑–æ–≤—É" ||
            this.value === "custom"
          ) {
            this.setCustomValidity("");
          } else {
            this.setCustomValidity("–û–±–µ—Ä—ñ—Ç—å –≤–∞–ª—ñ–¥–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç");
          }
        });

      document
        .getElementById("birth_date")
        .addEventListener("blur", function () {
          if (this.value && !validateDate(this.value)) {
            this.setCustomValidity(
              "–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –¥–∞—Ç—É —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä—Ä—Ä"
            );
          } else {
            this.setCustomValidity("");
          }
        });

      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è –ø–æ–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ—ó –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É
      document
        .getElementById("enlistment_date_custom")
        .addEventListener("blur", function () {
          if (this.value && !validateDate(this.value)) {
            this.setCustomValidity(
              "–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –¥–∞—Ç—É —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä—Ä—Ä"
            );
          } else {
            this.setCustomValidity("");
          }
        });

      form.addEventListener("submit", function () {
        // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è –ø–æ–ª—è –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É
        const enlistmentSelect = document.getElementById("enlistment_date");
        const customInput = document.getElementById("enlistment_date_custom");

        if (enlistmentSelect.value === "custom" && !customInput.value) {
          customInput.setCustomValidity("–í–∫–∞–∂—ñ—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É");
          customInput.reportValidity();
          return false;
        }

        if (form.checkValidity()) {
          loader.style.display = "flex";
          submitButton.disabled = true;

          let cookieCheck = setInterval(function () {
            if (getCookie("fileDownload") === "true") {
              clearInterval(cookieCheck);
              loader.style.display = "none";
              submitButton.disabled = false;
              document.cookie =
                "fileDownload=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            }
          }, 500);
        }
      });

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      document.addEventListener("DOMContentLoaded", function () {
        const enlistmentSelect = document.getElementById("enlistment_date");
        if (enlistmentSelect.value) {
          toggleCustomDate();
        }
      });

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É
      function toggleCustomDate() {
        const select = document.getElementById("enlistment_date");
        const customInput = document.getElementById("enlistment_date_custom");

        if (select.value === "custom") {
          customInput.style.display = "block";
          customInput.required = true;
          // –û—á–∏—â–∞—î–º–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é select, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä—ñ–±–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è custom –ø–æ–ª—è
          select.setCustomValidity("");
        } else {
          customInput.style.display = "none";
          customInput.required = false;
          customInput.value = "";
          customInput.setCustomValidity("");
          // –í–∞–ª—ñ–¥—É—î–º–æ select
          if (!select.value) {
            select.setCustomValidity("–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç –¥–∞—Ç–∏ –ø—Ä–∏–∑–æ–≤—É");
          } else if (
            select.value === "–∑ –º–æ–º–µ–Ω—Ç—É –ø—Ä–∏–∑–æ–≤—É" ||
            select.value === "custom"
          ) {
            select.setCustomValidity("");
          } else {
            select.setCustomValidity("–û–±–µ—Ä—ñ—Ç—å –≤–∞–ª—ñ–¥–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç");
          }
        }
      }
    </script>
  </body>
</html>
