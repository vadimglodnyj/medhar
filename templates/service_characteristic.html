{% extends "base.html" %}

{% block title %}Службова характеристика - МедХар{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="page-header text-center">
                <h1><i class="fas fa-user-tie me-3"></i>Службова характеристика</h1>
                <p class="lead">Генерація службової характеристики військовослужбовця</p>
            </div>

            <!-- Відображення повідомлень -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Форма генерації -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Заповніть дані для генерації</h5>
                </div>
                <div class="card-body">
                    <form id="generation-form" method="POST">
                        <!-- ПІБ -->
                        <div class="mb-3">
                            <label for="pib" class="form-label">
                                <i class="fas fa-user me-1"></i>ПІБ військовослужбовця
                            </label>
                            <input
                                type="text"
                                id="pib"
                                name="pib"
                                class="form-control"
                                placeholder="Прізвище Ім'я По батькові"
                                required
                            />
                        </div>

                        <!-- Звання -->
                        <div class="mb-3">
                            <label for="zvanie" class="form-label">
                                <i class="fas fa-shield-alt me-1"></i>Військове звання
                            </label>
                            <select id="zvanie" name="zvanie" class="form-select" required>
                                <option value="">Оберіть звання</option>
                                <option value="солдат">солдат</option>
                                <option value="старший солдат">старший солдат</option>
                                <option value="молодший сержант">молодший сержант</option>
                                <option value="сержант">сержант</option>
                                <option value="старший сержант">старший сержант</option>
                                <option value="головний сержант">головний сержант</option>
                                <option value="штаб-сержант">штаб-сержант</option>
                                <option value="майстер-сержант">майстер-сержант</option>
                                <option value="старший майстер-сержант">старший майстер-сержант</option>
                                <option value="головний майстер-сержант">головний майстер-сержант</option>
                                <option value="молодший лейтенант">молодший лейтенант</option>
                                <option value="лейтенант">лейтенант</option>
                                <option value="старший лейтенант">старший лейтенант</option>
                                <option value="капітан">капітан</option>
                                <option value="майор">майор</option>
                                <option value="підполковник">підполковник</option>
                                <option value="полковник">полковник</option>
                            </select>
                        </div>

                        <!-- Підрозділ -->
                        <div class="mb-3">
                            <label for="podrozdil" class="form-label">
                                <i class="fas fa-building me-1"></i>Підрозділ
                            </label>
                            <input
                                type="text"
                                id="podrozdil"
                                name="podrozdil"
                                class="form-control"
                                placeholder="Назва підрозділу"
                                required
                            />
                        </div>

                        <!-- Дата народження -->
                        <div class="mb-3">
                            <label for="birth_date" class="form-label">
                                <i class="fas fa-birthday-cake me-1"></i>Дата народження
                            </label>
                            <input
                                type="text"
                                id="birth_date"
                                name="birth_date"
                                class="form-control"
                                placeholder="дд.мм.рррр"
                                pattern="\d{2}\.\d{2}\.\d{4}"
                                title="Введіть дату у форматі дд.мм.рррр"
                                required
                            />
                        </div>

                        <!-- Службова діяльність -->
                        <div class="mb-3">
                            <label for="service_activity" class="form-label">
                                <i class="fas fa-tasks me-1"></i>Службова діяльність
                            </label>
                            <textarea
                                id="service_activity"
                                name="service_activity"
                                class="form-control"
                                rows="4"
                                placeholder="Опишіть службову діяльність військовослужбовця..."
                                required
                            ></textarea>
                        </div>

                        <!-- Професійні якості -->
                        <div class="mb-3">
                            <label for="professional_qualities" class="form-label">
                                <i class="fas fa-star me-1"></i>Професійні якості
                            </label>
                            <textarea
                                id="professional_qualities"
                                name="professional_qualities"
                                class="form-control"
                                rows="3"
                                placeholder="Опишіть професійні якості..."
                                required
                            ></textarea>
                        </div>

                        <!-- Моральні якості -->
                        <div class="mb-3">
                            <label for="moral_qualities" class="form-label">
                                <i class="fas fa-heart me-1"></i>Моральні якості
                            </label>
                            <textarea
                                id="moral_qualities"
                                name="moral_qualities"
                                class="form-control"
                                rows="3"
                                placeholder="Опишіть моральні якості..."
                                required
                            ></textarea>
                        </div>

                        <!-- Висновок -->
                        <div class="mb-3">
                            <label for="conclusion" class="form-label">
                                <i class="fas fa-gavel me-1"></i>Висновок
                            </label>
                            <textarea
                                id="conclusion"
                                name="conclusion"
                                class="form-control"
                                rows="3"
                                placeholder="Висновок щодо військовослужбовця..."
                                required
                            ></textarea>
                        </div>

                        <!-- Підписує характеристику -->
                        <div class="mb-3">
                            <label for="signatory" class="form-label">
                                <i class="fas fa-signature me-1"></i>Підписує характеристику
                            </label>
                            <select id="signatory" name="signatory" class="form-select" required>
                                <option value="">Оберіть підписанта</option>
                                <option value="acting_chief">
                                    Т. в. о. начальника медичної служби секції тилу капітан м\с Ірина ГОНЧАРОВА
                                </option>
                                <option value="chief">
                                    Начальник медичної служби секції тилу капітан м\с Юлія ЮРЧАК
                                </option>
                                <option value="company_commander">
                                    Командир медичної роти капітан м/с Євгеній МАЖАЄВ
                                </option>
                            </select>
                        </div>

                        <div class="d-grid">
                            <button
                                id="submit-button"
                                type="submit"
                                class="btn btn-success btn-lg"
                            >
                                <i class="fas fa-user-tie me-2"></i>
                                Створити службову характеристику
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const form = document.getElementById("generation-form");
    const submitButton = document.getElementById("submit-button");

    // Валідація дати
    function validateDate(dateString) {
        const pattern = /^(\d{2})\.(\d{2})\.(\d{4})$/;
        const match = dateString.match(pattern);
        if (!match) return false;

        const day = parseInt(match[1], 10);
        const month = parseInt(match[2], 10);
        const year = parseInt(match[3], 10);

        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;
        if (year < 1900 || year > new Date().getFullYear()) return false;

        const date = new Date(year, month - 1, day);
        return (
            date.getDate() === day &&
            date.getMonth() === month - 1 &&
            date.getFullYear() === year
        );
    }

    // Валідація поля дати народження
    document.getElementById("birth_date").addEventListener("blur", function () {
        if (this.value && !validateDate(this.value)) {
            this.setCustomValidity("Введіть коректну дату у форматі дд.мм.рррр");
        } else {
            this.setCustomValidity("");
        }
    });

    // Обробка відправки форми
    form.addEventListener("submit", function () {
        if (form.checkValidity()) {
            showLoading();
            submitButton.disabled = true;
        }
    });
</script>
{% endblock %}
