# План міграції мед характеристик з Excel на БД

## Поточний стан

### Що працює з Excel:

1. **PersonnelDatabase** (`utils/database_reader.py`) - читає Excel файли з персоналом
2. **Медичні характеристики** - використовують PersonnelDatabase для автозаповнення даних
3. **Службові характеристики** - також використовують PersonnelDatabase
4. **ВЛК рапорти** - використовують PersonnelDatabase

### Що вже працює з БД:

1. **NewMedicalDatabase** (`utils/new_medical_database.py`) - SQLite БД з таблицями:
   - `patients` - пацієнти
   - `units` - підрозділи
   - `diagnoses` - діагнози
   - `treatments` - лікування
   - `payments` - виплати

## План міграції

### Етап 1: Створення уніфікованої БД (1-2 дні)

1. **Розширити NewMedicalDatabase**:

   - Додати таблицю `personnel` для даних персоналу
   - Мігрувати дані з Excel файлів персоналу в БД
   - Створити API для роботи з персоналом

2. **Створити PersonnelDatabaseDB** клас\*\*:
   ```python
   class PersonnelDatabaseDB:
       def search_by_surname(self, surname)
       def get_personnel_data(self, person_id)
       def get_medical_history(self, person_id)
       def get_treatment_summary(self, person_id)
   ```

### Етап 2: Модифікація генераторів (2-3 дні)

1. **Оновити BaseDocumentGenerator**:

   - Додати підтримку NewMedicalDatabase
   - Створити уніфікований інтерфейс для роботи з даними

2. **Модифікувати MedicalCharacteristicGenerator**:

   - Замінити PersonnelDatabase на PersonnelDatabaseDB
   - Додати отримання медичної історії з БД
   - Покращити логіку формування історії лікування

3. **Оновити ServiceCharacteristicGenerator**:

   - Інтегрувати з БД для отримання службової інформації
   - Додати автоматичне заповнення з БД

4. **Модифікувати VLKReportGenerator**:
   - Додати отримання медичних даних з БД
   - Покращити формування рапорту

### Етап 3: Покращення UI (1-2 дні)

1. **Автозаповнення з БД**:

   - Покращити пошук ПІБ з використанням БД
   - Додати автозаповнення медичних даних
   - Створити попередній перегляд даних

2. **Валідація даних**:
   - Перевірка наявності пацієнта в БД
   - Валідація медичних даних
   - Попередження про відсутні дані

### Етап 4: Тестування та оптимізація (1-2 дні)

1. **Тестування**:

   - Перевірка всіх генераторів
   - Тестування з реальними даними
   - Перевірка продуктивності

2. **Оптимізація**:
   - Індексація БД для швидкого пошуку
   - Кешування часто використовуваних даних
   - Оптимізація SQL запитів

## Переваги міграції

### Технічні:

- **Швидкість**: SQL запити швидші за Excel
- **Надійність**: ACID транзакції, цілісність даних
- **Масштабованість**: Легше додавати нові функції
- **Інтеграція**: Єдина БД для всіх модулів

### Функціональні:

- **Автозаповнення**: Медичні дані автоматично заповнюються з БД
- **Валідація**: Перевірка наявності пацієнта в БД
- **Історія**: Повна медична історія з БД
- **Аналітика**: Статистика по пацієнтах

## Ризики та мітигація

### Ризики:

1. **Втрата даних** - мітигація: резервні копії, поетапна міграція
2. **Проблеми з продуктивністю** - мітигація: індексація, оптимізація
3. **Складність розробки** - мітигація: поетапна реалізація

### План відкату:

- Збереження поточної функціональності
- Можливість повернення до Excel
- Поетапне тестування

## Час реалізації: 5-9 днів

### День 1-2: Створення уніфікованої БД

### День 3-5: Модифікація генераторів

### День 6-7: Покращення UI

### День 8-9: Тестування та оптимізація
